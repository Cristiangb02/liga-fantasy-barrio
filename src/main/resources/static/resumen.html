<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resumen Jornada - Fantasy</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1a237e">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; margin: 0; padding: 10px; color: #333; }

        /* Cabecera con bot√≥n volver */
        .header-resumen {
            background: linear-gradient(135deg, #1a237e, #0d47a1);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        .btn-volver {
            background: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        /* Tarjeta de cada M√°nager */
        .manager-card {
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow: hidden;
            animation: fadeIn 0.5s;
        }
        .manager-header {
            background: #eceff1;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
        }
        .manager-name { font-weight: 800; color: #1a237e; font-size: 1.1em; }
        .manager-points {
            background: #1a237e;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-weight: bold;
        }

        /* Lista de Jugadores */
        .players-list { padding: 10px; }
        .player-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #f0f0f0;
        }
        .player-row:last-child { border-bottom: none; }

        .player-info { display: flex; align-items: center; gap: 10px; }
        .pos-badge {
            font-size: 0.7em;
            font-weight: 900;
            padding: 3px 6px;
            border-radius: 4px;
            color: white;
            width: 25px;
            text-align: center;
        }
        /* Colores Posiciones */
        .pos-portero { background: #7b1fa2; }
        .pos-defensa { background: #d32f2f; }
        .pos-medio { background: #f57c00; }
        .pos-delantero { background: #388e3c; }

        /* Colores Puntos (Lo que pediste) */
        .pts-box { font-weight: 900; font-size: 1.1em; }
        .pts-green { color: #2e7d32; }   /* Positivo */
        .pts-orange { color: #ff9800; }  /* Cero */
        .pts-red { color: #d32f2f; }     /* Negativo */

        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        .no-data { text-align: center; color: #666; margin-top: 50px; }
    </style>
</head>
<body>

<div class="header-resumen">
    <h2 style="margin:0;">üèÅ Resultados J-Anterior</h2>
    <a href="fantasy.html" class="btn-volver">üîô Volver</a>
</div>

<div id="contenedor-resumen">
    <div style="text-align:center; padding:20px;">Cargando resultados...</div>
</div>

<script>
    // 1. Obtener datos al cargar
    window.onload = function() {
        fetch('/jornada/resumen')
            .then(r => r.json())
            .then(data => {
                const container = document.getElementById('contenedor-resumen');

                if (!data || data.length === 0) {
                    container.innerHTML = `
                        <div class="no-data">
                            <h3>ü§∑‚Äç‚ôÇÔ∏è No hay datos disponibles</h3>
                            <p>O bien es la primera jornada, o a√∫n no se ha cerrado la jornada anterior.</p>
                        </div>`;
                    return;
                }

                container.innerHTML = data.map(m => {
                    // Generar lista de jugadores
                    let htmlJugadores = m.jugadores.map(j => {
                        // L√≥gica de colores para los puntos
                        let colorClass = 'pts-orange'; // Por defecto 0
                        if (j.puntos > 0) colorClass = 'pts-green';
                        if (j.puntos < 0) colorClass = 'pts-red';

                        let posClass = 'pos-' + (j.posicion ? j.posicion.toLowerCase() : 'medio');

                        return `
                        <div class="player-row">
                            <div class="player-info">
                                <span class="pos-badge ${posClass}">${j.posicion ? j.posicion.substring(0,3).toUpperCase() : '???'}</span>
                                <span style="font-weight:600; color:#333;">${j.nombre}</span>
                            </div>
                            <div class="pts-box ${colorClass}">${j.puntos}</div>
                        </div>`;
                    }).join('');

                    return `
                    <div class="manager-card">
                        <div class="manager-header">
                            <span class="manager-name">üë§ ${m.manager}</span>
                            <span class="manager-points">${m.puntosTotal} pts</span>
                        </div>
                        <div class="players-list">
                            ${htmlJugadores}
                        </div>
                    </div>`;
                }).join('');
            })
            .catch(err => {
                document.getElementById('contenedor-resumen').innerHTML = '<p style="text-align:center; color:red;">Error al cargar resultados.</p>';
                console.error(err);
            });
    };
</script>

</body>
</html>